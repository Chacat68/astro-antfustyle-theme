---
import { getLocalizedBlogPosts, getSortedPosts } from '~/utils/data'
import { ensureTrailingSlash } from '~/utils/path'
import { getRelativeLocaleUrl } from 'astro:i18n'
import { getLocale, useTranslations } from '~/i18n/translate'

interface Props {
  limit?: number
}

const { limit = 6 } = Astro.props

const locale = getLocale(Astro.currentLocale)
const t = useTranslations(locale)
const toPostHref = (id: string) =>
  ensureTrailingSlash(getRelativeLocaleUrl(locale, `blog/${id}`))

// 获取最新的博客文章
const allPosts = await getLocalizedBlogPosts(Astro.currentLocale)
const sortedPosts = getSortedPosts(allPosts)
const latestPosts = sortedPosts.slice(0, limit)
---

<div class="latest-posts">
  <h2>{t('widget.latestPosts')}</h2>
  <ul class="post-list">
    {
      latestPosts.map((post) => (
        <li>
          <a href={toPostHref(post.id)}>{post.data.title}</a>
          {post.data.category && (
            <span class="category"> - {post.data.category}</span>
          )}
        </li>
      ))
    }
  </ul>
</div>

<style>
  .latest-posts {
    margin-bottom: 2rem;
  }

  .post-list {
    list-style: none;
    padding: 0;
  }

  .post-list li {
    margin-bottom: 0.5rem;
    line-height: 1.8;
  }

  .post-list a {
    text-decoration: none;
    color: inherit;
  }

  .post-list a:hover {
    text-decoration: underline;
  }

  .category {
    opacity: 0.7;
    font-size: 0.9em;
  }
</style>
