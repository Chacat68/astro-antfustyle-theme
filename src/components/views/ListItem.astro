---
import Link from '~/components/base/Link.astro'

import { ensureTrailingSlash } from '~/utils/path'
import { formatDate } from '~/utils/datetime'
import { getRelativeLocaleUrl } from 'astro:i18n'
import { getLocale, useTranslations } from '~/i18n/translate'
import { localeToHtmlLang } from '~/i18n/locale-meta'

interface Props {
  idx: number
  collectionType: string
  redirect?: string
  postSlug?: string
  title: string
  video?: boolean
  radio?: boolean
  date: string | Date
  minutesRead?: number
  platform?: string
}

const {
  idx,
  redirect,
  collectionType,
  postSlug,
  title,
  video,
  radio,
  date,
  minutesRead,
  platform,
} = Astro.props

const locale = getLocale(Astro.currentLocale)
const t = useTranslations(locale)
const dateLocale = localeToHtmlLang(locale)

const internalHref = ensureTrailingSlash(
  getRelativeLocaleUrl(locale, `${collectionType}/${postSlug ?? ''}`)
)
---

<div class="slide-enter" style={{ '--enter-stage': idx }}>
  <Link
    u-flex="~ items-center lt-md:(col items-start) gap-2"
    class="border-b-none! mb-6 mt-2 op-transition!"
    href={redirect ?? internalHref}
    external={redirect ? true : false}
    enableNewTabWarning={redirect ? true : false}
  >
    <Fragment slot="title">{title}</Fragment>
    <span slot="end" u-flex="~ gap-2 items-center">
      {
        video && (
          <span
            u-i-ri-film-line
            class="flex-none op-50 align-middle"
            title={t('list.video')}
            aria-label={t('list.video')}
          />
        )
      }
      {
        radio && (
          <span
            u-i-ri-radio-line
            class="flex-none op-50 align-middle"
            title={t('list.radio')}
            aria-label={t('list.radio')}
          />
        )
      }
      <time
        class="op-50 text-sm ws-nowrap"
        datetime={new Date(date).toISOString()}
      >
        {formatDate(date, false, false, dateLocale)}
      </time>
      {
        typeof minutesRead === 'number' && minutesRead > 0 && (
          <span class="op-40 text-sm ws-nowrap">
            · {minutesRead} {t('post.min')}
          </span>
        )
      }
      {platform && <span class="op-40 text-sm ws-nowrap">· {platform}</span>}
    </span>
  </Link>
</div>
